# 코드베이스 조사

병렬 하위 에이전트를 생성하고 그 결과를 종합하여 사용자 질문에 답하기 위해 코드베이스 전반을 포괄적으로 조사하는 임무를 수행합니다.

## 초기 설정:

이 명령이 호출되면 다음과 같이 응답하세요:
```
코드베이스를 조사할 준비가 되었습니다. 연구 질문이나 관심 영역을 알려주시면, 관련 구성 요소와 연결을 탐색하여 철저히 분석하겠습니다.
```

그 후 사용자의 연구 질문을 기다립니다.

## 연구 질문을 받은 뒤 따를 단계:

1. **직접 언급된 파일을 먼저 읽기:**
   - 사용자가 특정 파일(문서, JSON 등)을 언급하면 먼저 "완전히" 읽습니다
   - **중요**: 전체 파일을 읽기 위해 Read 도구를 limit/offset 매개변수 없이 사용합니다
   - **치명적**: 어떤 하위 작업을 생성하기 전에, 이 파일들을 반드시 메인 컨텍스트에서 직접 읽습니다
   - 이렇게 하면 조사를 분해하기 전에 전체 맥락을 확보할 수 있습니다

2. **연구 질문을 분석하고 분해하기:**
   - 사용자의 질문을 구성 가능한 연구 영역으로 분해합니다
   - 사용자가 찾고자 하는 근본 패턴, 연결 관계, 아키텍처적 함의를 심층적으로 사고합니다
   - 조사할 구체적 구성 요소, 패턴, 개념을 식별합니다
   - 모든 하위 작업을 추적하는 연구 계획을 만듭니다
   - 관련된 디렉터리, 파일, 아키텍처 패턴을 고려합니다

3. **포괄적 조사를 위해 병렬 하위 에이전트 작업 생성:**
   - 여러 Task 에이전트를 만들어 서로 다른 측면을 동시에 조사합니다
   - 코드베이스 조사는 하위 에이전트로 수행합니다

4. **모든 하위 에이전트 완료 대기 후 결과 종합:**
   - 중요: 계속 진행하기 전에 모든 하위 에이전트 작업이 완료될 때까지 기다립니다
   - 모든 하위 에이전트 결과(코드베이스 결과와 thoughts 결과 모두)를 취합합니다
   - 실시간 코드베이스에서의 발견을 1차 신뢰 원천으로 우선시합니다
   - 서로 다른 구성 요소 간 발견 사항을 연결합니다
   - 패턴, 연결 관계, 아키텍처적 결정을 강조합니다
   - 구체적 증거를 들어 사용자의 질문에 답합니다

5. **연구 문서를 위한 메타데이터 수집:**
   - DATETIME
   - REPO_ROOT
   - REPO_NAME
   - GIT_BRANCH
   - GIT_COMMIT
   - FILENAME: `research/YYYY-MM-DD_HH-MM-SS_topic.md`

6. **연구 문서 생성:**
   - 4단계에서 수집한 메타데이터를 사용합니다
   - 문서는 YAML 프런트매터와 본문 순서로 구성합니다:
     ```markdown
     ---
     date: [Current date and time with timezone in ISO format]
     researcher: [Researcher name from thoughts status]
     git_commit: [Current commit hash]
     branch: [Current branch name]
     repository: [Repository name]
     topic: "[User's Question/Topic]"
     tags: [research, codebase, relevant-component-names]
     status: complete
     last_updated: [Current date in YYYY-MM-DD format]
     last_updated_by: [Researcher name]
     ---

     # 연구: [사용자 질문/주제]

     **Date**: [4단계의 현재 날짜와 시간(시간대 포함)]
     **Researcher**: [thoughts 상태의 연구자 이름]
     **Git Commit**: [4단계의 현재 커밋 해시]
     **Branch**: [4단계의 현재 브랜치 이름]
     **Repository**: [저장소 이름]

     ## 연구 질문
     [원본 사용자 질문]

     ## 요약
     [사용자 질문에 답하는 상위 수준의 발견]

     ## 상세 발견

     ### [구성 요소/영역 1]
     - 참조 포함 발견 사항([file.ext:line](link))
     - 다른 구성 요소와의 연결
     - 구현 세부 사항

     ### [구성 요소/영역 2]
     ...

     ## 코드 참조
     - `path/to/file.py:123` - 해당 내용 설명
     - `another/file.ts:45-67` - 코드 블록 설명

     ## 아키텍처 인사이트
     [발견된 패턴, 규약, 설계 결정]

     ## 역사적 맥락(thoughts/ 기반)
     [참조와 함께 thoughts/ 디렉터리에서의 관련 인사이트]
     - `thoughts/something.md` - X에 대한 역사적 결정, Y에 대한 과거 탐색

     ## 관련 연구
     [research/ 내 다른 연구 문서 링크]

     ## 미해결 질문
     [추가 조사가 필요한 영역]
     ```

7. **결과 제시:**
   - 사용자에게 발견 사항을 간결히 요약하여 제시합니다
   - 탐색을 돕는 핵심 파일 참조를 포함합니다
   - 후속 질문이나 추가 설명이 필요한지 묻습니다

8. **후속 질문 처리:**
   - 사용자가 후속 질문을 하면 동일한 연구 문서에 내용을 추가합니다
   - 프런트매터의 `last_updated`, `last_updated_by` 필드를 갱신합니다
   - 프런트매터에 `last_updated_note: "[간단 설명]에 대한 후속 연구 추가"`를 추가합니다
   - 새로운 섹션을 추가합니다: `## 후속 연구 [timestamp]`
   - 필요 시 추가 조사를 위해 새로운 하위 에이전트를 생성합니다
   - 문서 업데이트와 동기화를 지속합니다

## 중요 메모:
- 효율을 극대화하고 컨텍스트 사용을 최소화하기 위해 항상 병렬 Task 에이전트를 사용하세요
- 항상 최신 코드베이스 조사를 수행하세요 — 기존 연구 문서에만 의존하지 마세요
- thoughts/ 디렉터리는 실시간 발견을 보완하는 역사적 맥락을 제공합니다
- 개발자 참조를 위해 구체적 파일 경로와 줄 번호 찾기에 집중하세요
- 연구 문서는 필요한 모든 맥락을 포함한 자기완결적 문서여야 합니다
- 각 하위 에이전트 프롬프트는 구체적이며 읽기 전용 작업에 집중해야 합니다
- 교차 구성 요소 연결 및 아키텍처 패턴을 고려하세요
- 연구가 수행된 시점(시간적 맥락)을 포함하세요
- 메인 에이전트는 깊은 파일 읽기보다 "종합"에 집중하세요
- 하위 에이전트가 정의만이 아니라 예시와 사용 패턴도 찾도록 유도하세요
- thoughts/ 디렉터리 전체를 탐색하세요. research 하위 디렉터리만 보지 마세요
- **파일 읽기**: 언급된 파일은 항상 "완전히" 읽고(limit/offset 없음) 하위 작업을 생성하세요
- **중요한 순서**: 번호가 매겨진 단계를 정확히 따르세요
  - (1단계) 하위 작업을 생성하기 전에 언급된 파일을 먼저 읽습니다
  - (2단계) 종합하기 전에 모든 하위 에이전트가 완료될 때까지 기다립니다
  - (3단계) 문서를 작성하기 전에 메타데이터를 먼저 수집합니다
  - 플레이스홀더 값으로 연구 문서를 작성하지 않습니다
- **프런트매터 일관성**:
  - 모든 연구 문서의 시작에 프런트매터를 포함합니다
  - 프런트매터 필드는 모든 연구 문서에서 일관되게 유지합니다
  - 후속 연구를 추가할 때 프런트매터를 갱신합니다
  - 복합어 필드는 snake_case를 사용합니다(예: `last_updated`, `git_commit`)
  - 태그는 연구 주제와 조사된 구성 요소와 관련되어야 합니다
