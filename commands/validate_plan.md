# 계획 검증

구현 계획이 올바르게 실행되었는지 검증하는 임무를 수행합니다. 모든 성공 기준을 확인하고, 일탈이나 문제를 식별합니다.

## 초기 설정

호출 시:
1. **컨텍스트 파악** — 기존 대화의 연속인지, 새로 시작하는지 확인합니다
   - 기존: 이번 세션에서 무엇이 구현되었는지 검토
   - 신규: git과 코드베이스 분석을 통해 무엇이 수행되었는지 파악 필요

2. **계획 위치 찾기**:
   - 계획 경로가 제공되면 그것을 사용
   - 아니면 최근 커밋에서 계획 참조를 검색하거나 사용자에게 문의

3. **구현 증거 수집**:
   ```bash
   # 최근 커밋 확인
   git log --oneline -n 20
   git diff HEAD~N..HEAD  # N은 구현 커밋 범위를 포괄

   # 포괄적 점검 실행
   cd $(git rev-parse --show-toplevel) && make check test
   ```

## 검증 프로세스

### 1단계: 컨텍스트 발견

새로 시작했거나 추가 컨텍스트가 필요하다면:

1. **구현 계획**을 완전히 읽습니다
2. **변경되어야 할 사항 식별**:
   - 수정되어야 할 모든 파일 나열
   - 모든 성공 기준(자동/수동) 기록
   - 검증해야 할 핵심 기능 식별

3. **병렬 연구 작업 생성**하여 구현 내용을 파악:
   ```
   작업 1 - 데이터베이스 변경 검증:
   마이그레이션 [N]이 추가되었는지, 스키마 변경이 계획과 일치하는지 조사.
   확인: 마이그레이션 파일, 스키마 버전, 테이블 구조
   반환: 계획 명세 대비 실제 구현 내용

   작업 2 - 코드 변경 검증:
   [기능]과 관련된 모든 수정 파일 찾기.
   실제 변경을 계획 명세와 비교.
   반환: 파일별 계획 대비 실제 비교

   작업 3 - 테스트 커버리지 검증:
   명세대로 테스트가 추가/수정되었는지 확인.
   테스트 명령을 실행하고 결과 수집.
   반환: 테스트 상태와 누락된 커버리지
   ```

### 2단계: 체계적 검증

계획의 각 단계에 대해:

1. **완료 상태 확인**:
   - 계획의 체크마크(- [x]) 확인
   - 실제 코드가 완료 주장과 일치하는지 검증

2. **자동 검증 실행**:
   - "자동 검증" 항목의 각 명령을 실행
   - 성공/실패 상태를 문서화
   - 실패 시, 근본 원인 분석

3. **수동 기준 평가**:
   - 수동 테스트가 필요한 항목 나열
   - 사용자 검증을 위한 명확한 단계 제공

4. **엣지 케이스에 대해 심층적으로 사고**:
   - 오류 조건이 처리되었는가?
   - 누락된 검증은 없는가?
   - 기존 기능을 깨뜨릴 가능성은 없는가?

### 3단계: 검증 보고서 생성

포괄적 검증 요약을 작성합니다:

```markdown
## 검증 보고서: [계획 이름]

### 구현 상태
✓ 1단계: [이름] - 완전 구현
✓ 2단계: [이름] - 완전 구현
⚠️ 3단계: [이름] - 부분 구현(이슈 참조)

### 자동 검증 결과

### 코드 리뷰 발견 사항

#### 계획과 일치:
- 오류 처리 흐름이 계획을 따름

#### 계획과의 편차:
- [file:line]에서 다른 변수명 사용
- [file:line]에 추가 검증 로직 포함(개선)

#### 잠재적 문제:
- 외래 키 인덱스 누락으로 성능 영향 가능
- 마이그레이션에 롤백 처리 없음

### 수동 테스트 필요:

### 권고 사항:
- 병합 전 린트 경고 해결
```

## 기존 컨텍스트가 있을 때의 진행

구현에 참여했다면:
- 대화 기록을 검토합니다
- todo 목록에서 완료 항목을 확인합니다
- 이번 세션에서 수행된 작업 검증에 집중합니다
- 단축이나 미완 항목이 있다면 솔직히 기록합니다

## 중요한 가이드라인

1. **철저하되 실용적으로** — 중요한 것에 집중
2. **모든 자동 점검 실행** — 검증을 건너뛰지 않기
3. **모든 것을 문서화** — 성공과 이슈 모두 기록
4. **비판적으로 사고** — 구현이 진짜 문제를 해결하는지 의심해 보기
5. **유지보수 고려** — 장기적으로 유지 가능한가?

## 검증 체크리스트

항상 다음을 확인:
- [ ] 완료로 표시된 모든 단계가 실제로 완료됨
- [ ] 자동 테스트 통과
- [ ] 코드가 기존 패턴을 따름
- [ ] 회귀가 도입되지 않음
- [ ] 오류 처리가 견고함
- [ ] 필요 시 문서가 업데이트됨
- [ ] 수동 테스트 단계가 명확함

## 다른 명령과의 관계

권장 워크플로우:
1. 구현을 수행
2. 변경을 원자적 커밋으로 분리
3. 구현의 정확성 검증

검증은 커밋이 만들어진 이후에 가장 효과적입니다. git 기록을 분석하여 무엇이 구현되었는지 파악할 수 있기 때문입니다.

명심하세요: 좋은 검증은 문제가 프로덕션에 도달하기 전에 발견합니다. 건설적이되 철저하게, 격차나 개선점을 식별하세요.
